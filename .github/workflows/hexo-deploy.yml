name: Hexo Deploy to GitHub Pages

on:
  push:
    branches: [ main ]  # 仅监听main分支推送

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # 拉取完整提交历史，避免主题/文章缺失

      - name: Set up Node.js 16.x (稳定兼容版)
        uses: actions/setup-node@v4
        with:
          node-version: '16'
          cache: 'npm'  # 缓存npm依赖，加速构建

      - name: Install Dependencies (强制锁定兼容版本)
        run: |
          npm install -g hexo-cli@4.3.0
          npm install hexo@6.3.0 --save-exact
          npm install --force  # 强制解析依赖冲突，优先使用兼容版本

      - name: Build Hexo Static Files
        run: |
          hexo clean
          hexo generate

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
          publish_dir: ./public
          force_orphan: true  # 确保gh-pages分支干净，避免部署冲突